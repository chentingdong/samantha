FROM node:14-stretch-slim

RUN apt update && apt install -y git
RUN git config --global http.sslverify false

RUN mkdir /app
WORKDIR /app

COPY package.json yarn.lock /app/
RUN yarn -s install --frozen-lockfile && yarn -s cache clean

COPY . /app/

ARG SENTRY_RELEASE="local"
RUN echo "SENTRY_RELEASE=$SENTRY_RELEASE" >> /app/.sentryclirc

RUN yarn build

ENV PATH /app/node_modules/.bin:$PATH

EXPOSE 3000