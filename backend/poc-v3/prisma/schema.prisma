generator prisma_client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum State {
  PENDING
  ACTIVE
  COMPLETE
}

enum BlockType {
  COMPOSITE_PARALLEL
  COMPOSITE_SEQUENTIAL
  LEAF_FORM
  LEAF_API
}

enum Catalog {
  NONE
  BLOCK
  REQUEST
}

model User {
  id              String  @id
  name            String
  email           String
  requestedBlocks Block[] @relation("requestors", references: [id])
  respondedBlocks Block[] @relation("responders", references: [id])
}

model Block {
  id         Int       @default(autoincrement()) @id
  name       String
  type       BlockType @default(COMPOSITE_PARALLEL)
  catalog    Catalog   @default(NONE)
  state      State     @default(ACTIVE)
  control    String    @default("{}")
  context    String    @default("{}")
  parentId   Int?      @map("parent")
  parent     Block?    @relation("parentChildren", fields: [parentId], references: [id])
  children   Block[]   @relation("parentChildren")
  requestors User[]    @relation("requestors", references: [id])
  responders User[]    @relation("responders", references: [id])
}