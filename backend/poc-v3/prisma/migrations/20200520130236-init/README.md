# Migration `20200520130236-init`

This migration has been generated by Baiji He at 5/20/2020, 1:02:36 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "State" AS ENUM ('DRAFT', 'PENDING', 'ACTIVE', 'COMPLETE');

CREATE TYPE "BlockType" AS ENUM ('COMPOSITE_PARALLEL', 'COMPOSITE_SEQUENTIAL', 'LEAF_FORM', 'LEAF_API');

CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Block" (
"context" text  NOT NULL DEFAULT '{}',"control" text  NOT NULL DEFAULT '{}',"description" text  NOT NULL DEFAULT '',"id" SERIAL,"name" text  NOT NULL ,"parent" integer   ,"state" "State" NOT NULL DEFAULT 'DRAFT',"type" "BlockType" NOT NULL DEFAULT 'COMPOSITE_PARALLEL',
    PRIMARY KEY ("id"))

CREATE TABLE "public"."BlockDef" (
"context" text  NOT NULL DEFAULT '{}',"control" text  NOT NULL DEFAULT '{}',"description" text  NOT NULL DEFAULT '',"id" SERIAL,"name" text  NOT NULL ,"parent" integer   ,"type" "BlockType" NOT NULL DEFAULT 'COMPOSITE_PARALLEL',
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_requestors" (
"A" integer  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_responders" (
"A" integer  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "_requestors_AB_unique" ON "public"."_requestors"("A","B")

CREATE  INDEX "_requestors_B_index" ON "public"."_requestors"("B")

CREATE UNIQUE INDEX "_responders_AB_unique" ON "public"."_responders"("A","B")

CREATE  INDEX "_responders_B_index" ON "public"."_responders"("B")

ALTER TABLE "public"."Block" ADD FOREIGN KEY ("parent")REFERENCES "public"."Block"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."BlockDef" ADD FOREIGN KEY ("parent")REFERENCES "public"."BlockDef"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_requestors" ADD FOREIGN KEY ("A")REFERENCES "public"."Block"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_requestors" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_responders" ADD FOREIGN KEY ("A")REFERENCES "public"."Block"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_responders" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200520130236-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,57 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+enum State {
+  DRAFT
+  PENDING
+  ACTIVE
+  COMPLETE
+}
+
+enum BlockType {
+  COMPOSITE_PARALLEL
+  COMPOSITE_SEQUENTIAL
+  LEAF_FORM
+  LEAF_API
+}
+
+model User {
+  id              String  @id
+  name            String
+  email           String
+  requestedBlocks Block[] @relation("requestors", references: [id])
+  respondedBlocks Block[] @relation("responders", references: [id])
+}
+
+model Block {
+  id          Int       @default(autoincrement()) @id
+  name        String
+  description String    @default("")
+  type        BlockType @default(COMPOSITE_PARALLEL)
+  state       State     @default(DRAFT)
+  control     String    @default("{}")
+  context     String    @default("{}")
+  parentId    Int?      @map("parent")
+  parent      Block?    @relation("parentChildren", fields: [parentId], references: [id])
+  children    Block[]   @relation("parentChildren")
+  requestors  User[]    @relation("requestors", references: [id])
+  responders  User[]    @relation("responders", references: [id])
+}
+
+model BlockDef {
+  id          Int        @default(autoincrement()) @id
+  name        String
+  description String     @default("")
+  type        BlockType  @default(COMPOSITE_PARALLEL)
+  control     String     @default("{}")
+  context     String     @default("{}")
+  parentId    Int?       @map("parent")
+  parent      BlockDef?  @relation("blockDefParentChildren", fields: [parentId], references: [id])
+  children    BlockDef[] @relation("blockDefParentChildren")
+}
```


