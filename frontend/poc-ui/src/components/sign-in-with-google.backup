import React, { useEffect } from 'react';
import { Auth } from 'aws-amplify';
import config from '../config';

/**
* @author tchen@bellhop.io
* @function SignInWighGoogle
**/

const SignInWighGoogle = ( props ) => {
  useEffect( () => {
    function createScript () {
      // load the Google SDK
      const script = document.createElement( 'script' );
      script.src = 'https://apis.google.com/js/platform.js';
      script.async = true;
      script.onload = initGapi();
      document.body.appendChild( script );
    }
    function initGapi () {
      // init the Google SDK client
      const g = window.gapi;
      g.load( 'auth2', function () {
        g.auth2.init( {
          client_id: config.social.googleClientId,
          // authorized scopes
          scope: 'profile email openid'
        } );
      } );
    }

    const ga = window.gapi && window.gapi.auth2 ?
      window.gapi.auth2.getAuthInstance() :
      null;
    if ( !ga ) createScript();
  }, [] );

  function signIn () {
    const ga = window.gapi.auth2.getAuthInstance();
    ga.signIn().then(
      googleUser => {
        this.getAWSCredentials( googleUser );
      },
      error => {
        console.log( `SignIn error: ${ JSON.stringify( error ) }` );
      }
    );
  }


  return (
    <div>
      <button onClick={ signIn }>Sign in with Google</button>
    </div>
  );
};

export default SignInWighGoogle;